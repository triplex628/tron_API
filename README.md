# Tron Wallet микросервис

## Что сделал

- **Сервис на FastAPI:**  
  Принимает POST-запрос с адресом Tron-кошелька, получает через tronpy информацию (баланс TRX, Bandwidth, Energy), записывает запросы в PostgreSQL с помощью SQLAlchemy.

- **Эндпоинты:**  
  - **POST /query:** возвращает данные по кошельку и сохраняет запись в базе.  
  - **GET /queries:** возвращает историю запросов с поддержкой пагинации (параметры `skip` и `limit`).

- **Тестирование:**  
  Написаны интеграционные и юнит-тесты (pytest) для проверки эндпоинтов и логики записи в базу.

- **Контейнеризация:**  
  Использован Docker Compose для запуска приложения и базы PostgreSQL.
  
## Как работает

1. **/query (POST):**  
   - Принимается адрес кошелька.  
   - Данные запрашиваются через tronpy.  
   - Запрос сохраняется в базе и возвращается JSON с информацией о кошельке.

2. **/queries (GET):**  
   - Возвращает историю запросов.  
   - Можно использовать пагинацию, например, `skip=10&limit=10` для второй страницы.

## Тестирование

- **Интеграционные тесты:**  
  Проверяют работу `/query` и `/queries` через TestClient. Тесты отправляют запрос с тестовым адресом кошелька и ожидают ответ со статусом 200 (если данные корректно получены) или 400 (если адрес невалидный).

- **Юнит-тесты:**  
  Тестируют логику записи запроса в базу данных. С помощью monkeypatch подменяются вызовы tronpy, чтобы проверить, что после запроса в базе появляется запись с ожидаемыми значениями.

## Запуск

1. **Сборка и запуск контейнеров:**

   ```bash
   docker-compose up --build
   ```

   Документация будет доступна по адресу [http://localhost:8000/docs](http://localhost:8000/docs).

2. **Запуск тестов:**

   В Docker Desktop откройте контейнер web-1 и в разделе exec выполните:

   ```bash
   pytest -s
   ```
